(function(a){a.fn.extend({jTLine:function(b){var b=a.extend({eventsMinDistance:60,callType:'ajax',url:'',structureObj:[{}],distanceMode:'auto',fixDistanceValue:2,firstPointMargin:2,map:{dataRoot:'dataArray',isSelected:'isSelected',title:'title',subTitle:'subTitle',dateValue:'dateValue',pointCnt:'pointCnt',bodyCnt:'bodyCnt'},isSelectedAttrProvided:!1,formatTitle:function(){},formatSubTitle:function(){},formatBodyContent:function(){}},b),d={jsonObject:'jsonObject',ajax:'ajax',mappedJsonObject:'mappedJsonObject'},e=function(G){var H={};H.timelineWrapper=G.find('.events-wrapper'),H.eventsWrapper=H.timelineWrapper.children('.events'),H.fillingLine=H.eventsWrapper.children('.filling-line'),H.timelineEvents=H.eventsWrapper.find('a'),H.timelineDates=s(H.timelineEvents),H.eventsMinLapse=u(H.timelineDates),H.timelineNavigation=G.find('.cd-timeline-navigation'),H.eventsContent=G.children('.events-content'),m(H,b.eventsMinDistance);var I=n(H,b.eventsMinDistance);G.addClass('loaded'),H.timelineNavigation.on('click','.next',function(J){J.preventDefault(),f(H,I,'next')}),H.timelineNavigation.on('click','.prev',function(J){J.preventDefault(),f(H,I,'prev')}),H.eventsWrapper.on('click','a',function(J){J.preventDefault(),H.timelineEvents.removeClass('selected'),a(this).addClass('selected'),p(a(this)),k(a(this),H.fillingLine,I),o(a(this),H.eventsContent)}),H.eventsContent.on('swipeleft',function(){var J=w();'mobile'==J&&g(H,I,'next')}),H.eventsContent.on('swiperight',function(){var J=w();'mobile'==J&&g(H,I,'prev')}),a(document).keyup(function(J){'37'==J.which&&v(G.get(0))?g(H,I,'prev'):'39'==J.which&&v(G.get(0))&&g(H,I,'next')})},f=function(G,H,I){var J=q(G.eventsWrapper),K=+G.timelineWrapper.css('width').replace('px','');'next'==I?j(G,J-K+b.eventsMinDistance,K-H):j(G,J+K-b.eventsMinDistance)},g=function(G,H,I){var J=G.eventsContent.find('.selected'),K='next'==I?J.next():J.prev();if(0<K.length){var L=G.eventsWrapper.find('.selected'),M='next'==I?L.parent('li').next('li').children('a'):L.parent('li').prev('li').children('a');k(M,G.fillingLine,H),o(M,G.eventsContent),M.addClass('selected'),L.removeClass('selected'),p(M),h(I,M,G)}},h=function(G,H,I){var J=window.getComputedStyle(H.get(0),null),K=+J.getPropertyValue('left').replace('px',''),L=+I.timelineWrapper.css('width').replace('px',''),M=+I.eventsWrapper.css('width').replace('px',''),N=q(I.eventsWrapper);('next'==G&&K>L-N||'prev'==G&&K<-N)&&j(I,-K+L/2,L-M)},j=function(G,H,I){var J=G.eventsWrapper.get(0);H=0<H?0:H,H='undefined'!=typeof I&&H<I?I:H,r(J,'translateX',H+'px'),0==H?G.timelineNavigation.find('.prev').addClass('inactive'):G.timelineNavigation.find('.prev').removeClass('inactive'),H==I?G.timelineNavigation.find('.next').addClass('inactive'):G.timelineNavigation.find('.next').removeClass('inactive')},k=function(G,H,I){var J=window.getComputedStyle(G.get(0),null),K=J.getPropertyValue('left'),L=J.getPropertyValue('width');K=+K.replace('px','')+ +L.replace('px','')/2;var M=K/I;r(H.get(0),'scaleX',M)},l,m=function(G,H){var I,J,K,L=b.firstPointMargin;for(l=b.firstPointMargin,i=0;i<G.timelineDates.length;i++)'auto'==b.distanceMode?(I=t(G.timelineDates[0],G.timelineDates[i]),J=Math.round(I/G.eventsMinLapse)+2):'fixDistance'==b.distanceMode?0==i?J=b.firstPointMargin:(L+=b.fixDistanceValue,J=L):'predefinedDistance'==b.distanceMode&&(K=y.dataArray[i].nextDistance,0==i?J=b.firstPointMargin:(L+=K,J=L),l+=K),G.timelineEvents.eq(i).css('left',J*H+'px')},n=function(G,H){var I,J,K,M=b.firstPointMargin;if('auto'==b.distanceMode)I=t(G.timelineDates[0],G.timelineDates[G.timelineDates.length-1]),J=I/G.eventsMinLapse,J=Math.round(J)+4,K=J*H;else if('fixDistance'==b.distanceMode){var N=b.eventsMinDistance*b.fixDistanceValue,O=N*y.length;K=O}else'predefinedDistance'==b.distanceMode&&(K=l*b.eventsMinDistance);return G.eventsWrapper.css('width',K+'px'),p(G.eventsWrapper.find('a.selected')),k(G.eventsWrapper.find('a.selected'),G.fillingLine,K),h('next',G.eventsWrapper.find('a.selected'),G),K},o=function(G,H){var I=G.data('date'),J=H.find('.selected'),K=H.find('[data-date="'+I+'"]'),L=K.height();if(K.index()>J.index())var M='selected enter-right',N='leave-left';else var M='selected enter-left',N='leave-right';K.attr('class',M),J.attr('class',N).one('webkitAnimationEnd oanimationend msAnimationEnd animationend',function(){J.removeClass('leave-right leave-left'),K.removeClass('enter-left enter-right')}),H.css('height',L+'px')},p=function(G){G.parent('li').prevAll('li').children('a').addClass('older-event').end().end().nextAll('li').children('a').removeClass('older-event')},q=function(G){var H=window.getComputedStyle(G.get(0),null),I=H.getPropertyValue('-webkit-transform')||H.getPropertyValue('-moz-transform')||H.getPropertyValue('-ms-transform')||H.getPropertyValue('-o-transform')||H.getPropertyValue('transform');if(0<=I.indexOf('(')){var I=I.split('(')[1];I=I.split(')')[0],I=I.split(',');var J=I[4]}else var J=0;return+J},r=function(G,H,I){G.style['-webkit-transform']=H+'('+I+')',G.style['-moz-transform']=H+'('+I+')',G.style['-ms-transform']=H+'('+I+')',G.style['-o-transform']=H+'('+I+')',G.style.transform=H+'('+I+')'},s=function(G){var H=[];return G.each(function(){var I=a(this),J=I.data('date').split('T');if(1<J.length)var K=J[0].split('/'),L=J[1].split(':');else if(0<=J[0].indexOf(':'))var K=['2000','0','0'],L=J[0].split(':');else var K=J[0].split('/'),L=['0','0'];var M=new Date(K[2],K[1]-1,K[0],L[0],L[1]);H.push(M)}),H},t=function(G,H){var I=Math.round(H-G);return I},u=function(G){var H=[];for(i=1;i<G.length;i++){var I=t(G[i-1],G[i]);H.push(I)}return Math.min.apply(null,H)},v=function(G){for(var H=G.offsetTop,I=G.offsetLeft,J=G.offsetWidth,K=G.offsetHeight;G.offsetParent;)G=G.offsetParent,H+=G.offsetTop,I+=G.offsetLeft;return H<window.pageYOffset+window.innerHeight&&I<window.pageXOffset+window.innerWidth&&H+K>window.pageYOffset&&I+J>window.pageXOffset},w=function(){return window.getComputedStyle(document.querySelector('.jtline'),'::before').getPropertyValue('content').replace(/'/g,'').replace(/"/g,'')},x=function(G){A(G)},y,z=function(G){y=G},A=function(G){b.callType==d.ajax&&a.getJSON(b.url,function(){}).done(function(H){H?B(H,G):a(G).html('Error fetching data')}).fail(function(H){var I=H.status,J=H.statusText;a(G).html(J+I)}),b.callType==d.jsonObject&&(b.structureObj?B(b.structureObj,G):a(G).html('Error fetching data'))},B=function(G,H){var I='',J='',K;K='/'==b.map.dataRoot?G:G[b.map.dataRoot],z(K);var L,M=K.find(V=>'true'===V[b.map.isSelected]);M||(K[0][b.map.isSelected]='true');for(var N=0;N<K.length;N++)L=K[N][b.map.isSelected],point={isSelected:L,title:K[N][b.map.title],subTitle:K[N][b.map.subTitle],dateValue:K[N][b.map.dateValue],pointCnt:K[N][b.map.pointCnt],bodyCnt:K[N][b.map.bodyCnt]},I+='<li><a href="#0" data-date="'+point.dateValue+'" ',I+='class="tlnode '+(L?'selected':'')+'"',I+='>',I+=point.pointCnt+'</a></li>',J+='<li ',L&&(J+='class="selected"'),J+=' data-date="'+point.dateValue+'">'+C(point.title,K[N])+D(point.subTitle,K[N])+E(point.bodyCnt,K[N])+'</li>';var O=a(H),Q='<div class="timeline"><div class="events-wrapper"><div class="events"><ol>'+I+'</ol><span class="filling-line" aria-hidden="true"></span></div></div><ul class="cd-timeline-navigation"><li><a href="#0" class="prev inactive">Prev</a></li><li><a href="#0" class="next">Next</a></li></ul></div>',R='<div class="events-content"><ol>'+J+'</ol></div>';O.html('<section id="jtlinesection" class="jtline">'+Q+R+'</section>');var U=a('#jtlinesection',O);e(U)},C=function(G,H){var I=b.formatTitle(G,H);return I?b.formatTitle(G,H):'<h2>'+G+'</h2>'},D=function(G,H){var I=b.formatSubTitle(G,H);return I?b.formatSubTitle(G,H):'<em>'+point.subTitle+'</em>'},E=function(G,H){var I=b.formatBodyContent(G,H);return I?b.formatBodyContent(G,H):'<p>'+G+'</p>'},F=function(){a('.tlnode').on('click',function(G){b.onPointClick!==void 0&&b.onPointClick(G)})};return this.each(function(){var G=a(this);x(G),F()})}})})(jQuery);