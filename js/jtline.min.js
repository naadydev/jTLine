(function(n){n.fn.extend({jTLine:function(t){var d={eventsMinDistance:60,callType:"ajax",url:"",structureObj:[{}],distanceMode:"auto",fixDistanceValue:2,firstPointMargin:2,map:{dataRoot:"dataArray",isSelected:"isSelected",title:"title",subTitle:"subTitle",dateValue:"dateValue",pointCnt:"pointCnt",bodyCnt:"bodyCnt"},isSelectedAttrProvided:!1,formatTitle:function(){},formatSubTitle:function(){},formatBodyContent:function(){}},t=n.extend(d,t),h={jsonObject:"jsonObject",ajax:"ajax",mappedJsonObject:"mappedJsonObject"},g=function(i){var u={},e;u.timelineWrapper=i.find(".events-wrapper");u.eventsWrapper=u.timelineWrapper.children(".events");u.fillingLine=u.eventsWrapper.children(".filling-line");u.timelineEvents=u.eventsWrapper.find("a");u.timelineDates=it(u.timelineEvents);u.eventsMinLapse=rt(u.timelineDates);u.timelineNavigation=i.find(".cd-timeline-navigation");u.eventsContent=i.children(".events-content");nt(u,t.eventsMinDistance);e=tt(u,t.eventsMinDistance);i.addClass("loaded");u.timelineNavigation.on("click",".next",function(n){n.preventDefault();c(u,e,"next")});u.timelineNavigation.on("click",".prev",function(n){n.preventDefault();c(u,e,"prev")});u.eventsWrapper.on("click","a",function(t){t.preventDefault();u.timelineEvents.removeClass("selected");n(this).addClass("selected");v(n(this));f(n(this),u.fillingLine,e);a(n(this),u.eventsContent)});u.eventsContent.on("swipeleft",function(){var n=b();n=="mobile"&&r(u,e,"next")});u.eventsContent.on("swiperight",function(){var n=b();n=="mobile"&&r(u,e,"prev")});n(document).keyup(function(n){n.which=="37"&&w(i.get(0))?r(u,e,"prev"):n.which=="39"&&w(i.get(0))&&r(u,e,"next")})},c=function(n,i,r){var e=y(n.eventsWrapper),f=Number(n.timelineWrapper.css("width").replace("px",""));r=="next"?u(n,e-f+t.eventsMinDistance,f-i):u(n,e+f-t.eventsMinDistance)},r=function(n,t,i){var e=n.eventsContent.find(".selected"),o=i=="next"?e.next():e.prev(),u,r;o.length>0&&(u=n.eventsWrapper.find(".selected"),r=i=="next"?u.parent("li").next("li").children("a"):u.parent("li").prev("li").children("a"),f(r,n.fillingLine,t),a(r,n.eventsContent),r.addClass("selected"),u.removeClass("selected"),v(r),l(i,r,n))},l=function(n,t,i){var o=window.getComputedStyle(t.get(0),null),r=Number(o.getPropertyValue("left").replace("px","")),f=Number(i.timelineWrapper.css("width").replace("px","")),s=Number(i.eventsWrapper.css("width").replace("px","")),e=y(i.eventsWrapper);(n=="next"&&r>f-e||n=="prev"&&r<-e)&&u(i,-r+f/2,f-s)},u=function(n,t,i){var r=n.eventsWrapper.get(0);t=t>0?0:t;t=!(typeof i=="undefined")&&t<i?i:t;p(r,"translateX",t+"px");t==0?n.timelineNavigation.find(".prev").addClass("inactive"):n.timelineNavigation.find(".prev").removeClass("inactive");t==i?n.timelineNavigation.find(".next").addClass("inactive"):n.timelineNavigation.find(".next").removeClass("inactive")},f=function(n,t,i){var u=window.getComputedStyle(n.get(0),null),r=u.getPropertyValue("left"),e=u.getPropertyValue("width"),f;r=Number(r.replace("px",""))+Number(e.replace("px",""))/2;f=r/i;p(t.get(0),"scaleX",f)},e,nt=function(n,r){var c,u,h,f=t.firstPointMargin;for(e=t.firstPointMargin,i=0;i<n.timelineDates.length;i++)t.distanceMode=="auto"?(c=o(n.timelineDates[0],n.timelineDates[i]),u=Math.round(c/n.eventsMinLapse)+2):t.distanceMode=="fixDistance"?i!=0?(f+=t.fixDistanceValue,u=f):u=t.firstPointMargin:t.distanceMode=="predefinedDistance"&&(h=s.dataArray[i].nextDistance,i!=0?(f+=h,u=f):u=t.firstPointMargin,e+=h),n.timelineEvents.eq(i).css("left",u*r+"px")},tt=function(n,i){var h,u,r,v=t.firstPointMargin,c,a;return t.distanceMode=="auto"?(h=o(n.timelineDates[0],n.timelineDates[n.timelineDates.length-1]),u=h/n.eventsMinLapse,u=Math.round(u)+4,r=u*i):t.distanceMode=="fixDistance"?(c=t.eventsMinDistance*t.fixDistanceValue,a=c*s.length,r=a):t.distanceMode=="predefinedDistance"&&(r=e*t.eventsMinDistance),n.eventsWrapper.css("width",r+"px"),f(n.eventsWrapper.find("a.selected"),n.fillingLine,r),l("next",n.eventsWrapper.find("a.selected"),n),r},a=function(n,t){var e=n.data("date"),r=t.find(".selected"),i=t.find('[data-date="'+e+'"]'),o=i.height(),u,f;i.index()>r.index()?(u="selected enter-right",f="leave-left"):(u="selected enter-left",f="leave-right");i.attr("class",u);r.attr("class",f).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){r.removeClass("leave-right leave-left");i.removeClass("enter-left enter-right")});t.css("height",o+"px")},v=function(n){n.parent("li").prevAll("li").children("a").addClass("older-event").end().end().nextAll("li").children("a").removeClass("older-event")},y=function(n){var i=window.getComputedStyle(n.get(0),null),t=i.getPropertyValue("-webkit-transform")||i.getPropertyValue("-moz-transform")||i.getPropertyValue("-ms-transform")||i.getPropertyValue("-o-transform")||i.getPropertyValue("transform"),r;return t.indexOf("(")>=0?(t=t.split("(")[1],t=t.split(")")[0],t=t.split(","),r=t[4]):r=0,Number(r)},p=function(n,t,i){n.style["-webkit-transform"]=t+"("+i+")";n.style["-moz-transform"]=t+"("+i+")";n.style["-ms-transform"]=t+"("+i+")";n.style["-o-transform"]=t+"("+i+")";n.style.transform=t+"("+i+")"},it=function(t){var i=[];return t.each(function(){var e=n(this),t=e.data("date").split("T"),r,u,f;t.length>1?(r=t[0].split("/"),u=t[1].split(":")):t[0].indexOf(":")>=0?(r=["2000","0","0"],u=t[0].split(":")):(r=t[0].split("/"),u=["0","0"]);f=new Date(r[2],r[1]-1,r[0],u[0],u[1]);i.push(f)}),i},o=function(n,t){return Math.round(t-n)},rt=function(n){var t=[],r;for(i=1;i<n.length;i++)r=o(n[i-1],n[i]),t.push(r);return Math.min.apply(null,t)},w=function(n){for(var t=n.offsetTop,i=n.offsetLeft,r=n.offsetWidth,u=n.offsetHeight;n.offsetParent;)n=n.offsetParent,t+=n.offsetTop,i+=n.offsetLeft;return t<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&t+u>window.pageYOffset&&i+r>window.pageXOffset},b=function(){return window.getComputedStyle(document.querySelector(".jtline"),"::before").getPropertyValue("content").replace(/'/g,"").replace(/"/g,"")},ut=function(n){et(n)},s,ft=function(n){s=n},et=function(i){t.callType==h.ajax&&n.getJSON(t.url,function(){}).done(function(t){t?k(t,i):n(i).html("Error fetching data")}).fail(function(t){var r=t.status,u=t.statusText,f=u+r;n(i).html(f)});t.callType==h.jsonObject&&(t.structureObj?k(t.structureObj,i):n(i).html("Error fetching data"))},k=function(i,r){var e="",s="",f,o,u,c;for(f=t.map.dataRoot=="/"?i:i[t.map.dataRoot],ft(f),u=0;u<f.length;u++)o=f[u][t.map.isSelected],u==0&&(o="true"),point={isSelected:o,title:f[u][t.map.title],subTitle:f[u][t.map.subTitle],dateValue:f[u][t.map.dateValue],pointCnt:f[u][t.map.pointCnt],bodyCnt:f[u][t.map.bodyCnt]},e+='<li><a href="#0" data-date="'+point.dateValue+'" ',e+='class="tlnode '+(o?"selected":"")+'"',e+=">",e+=point.pointCnt+"<\/a><\/li>",s+="<li ",o&&(s+='class="selected"'),s+=' data-date="'+point.dateValue+'">'+ot(point.title,f[u])+st(point.subTitle,f[u])+ht(point.bodyCnt,f[u])+"<\/li>";var h=n(r),l='<div class="timeline"><div class="events-wrapper"><div class="events"><ol>'+e+'<\/ol><span class="filling-line" aria-hidden="true"><\/span><\/div><\/div><ul class="cd-timeline-navigation"><li><a href="#0" class="prev inactive">Prev<\/a><\/li><li><a href="#0" class="next">Next<\/a><\/li><\/ul><\/div>',a='<div class="events-content"><ol>'+s+"<\/ol><\/div>",v='<section id="jtlinesection" class="jtline">'+l+a+"<\/section>";h.html(v);c=n("#jtlinesection",h);g(c)},ot=function(n,i){var r=t.formatTitle(n,i);return r?t.formatTitle(n,i):"<h2>"+n+"<\/h2>"},st=function(n,i){var r=t.formatSubTitle(n,i);return r?t.formatSubTitle(n,i):"<em>"+point.subTitle+"<\/em>"},ht=function(n,i){var r=t.formatBodyContent(n,i);return r?t.formatBodyContent(n,i):"<p>"+n+"<\/p>"},ct=function(){n(".tlnode").on("click",function(n){if(t.onPointClick!==undefined)t.onPointClick(n)})};return this.each(function(){var t=n(this);ut(t);ct()})}})})(jQuery);